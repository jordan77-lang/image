<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Image Accessibility Tool</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1e40af; }
        input[type="text"] { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        textarea { width: 100%; height: 100px; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ API Test Tool</h1>
    <p>Use this tool to test your deployed API endpoint before integrating with the main site.</p>

    <div class="test-section">
        <h2>Configuration</h2>
        <label>API Endpoint URL:</label>
        <input type="text" id="apiEndpoint" placeholder="https://your-app-name.vercel.app/api" />
        <button onclick="testConnection()">Test Connection</button>
        <div id="connectionResult"></div>
    </div>

    <div class="test-section">
        <h2>Image Upload Test</h2>
        <input type="file" id="testImage" accept="image/*" />
        <label>Context (optional):</label>
        <textarea id="testContext" placeholder="This is a test image for accessibility descriptions"></textarea>
        
        <div style="margin: 10px 0;">
            <button onclick="testAltText()">Test Alt Text</button>
            <button onclick="testLongDescription()">Test Long Description</button>
            <button onclick="testBoth()">Test Both</button>
        </div>
        
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>Sample Image Test</h2>
        <p>Test with a base64-encoded sample image (small red square):</p>
        <button onclick="testSampleImage()">Test Sample Image</button>
        <div id="sampleResults"></div>
    </div>

    <script>
        const sampleImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChAGA6x/3HQAAAABJRU5ErkJggg==";

        async function testConnection() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const resultDiv = document.getElementById('connectionResult');
            
            if (!endpoint) {
                resultDiv.innerHTML = '<div class="result error">Please enter an API endpoint URL</div>';
                return;
            }

            try {
                resultDiv.innerHTML = '<div class="result">Testing connection...</div>';
                
                const response = await fetch(endpoint + '/generate-descriptions', {
                    method: 'OPTIONS'
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="result success">‚úÖ Connection successful! CORS headers are properly configured.</div>';
                } else {
                    resultDiv.innerHTML = '<div class="result error">‚ùå Connection failed. Status: ' + response.status + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Connection failed: ' + error.message + '</div>';
            }
        }

        async function testAPI(type) {
            const endpoint = document.getElementById('apiEndpoint').value;
            const imageFile = document.getElementById('testImage').files[0];
            const context = document.getElementById('testContext').value;
            const resultDiv = document.getElementById('testResults');

            if (!endpoint) {
                resultDiv.innerHTML = '<div class="result error">Please enter an API endpoint URL first</div>';
                return;
            }

            let imageData;
            if (imageFile) {
                imageData = await fileToBase64(imageFile);
            } else {
                imageData = sampleImage;
            }

            try {
                resultDiv.innerHTML = '<div class="result">Processing... This may take a few seconds.</div>';
                
                const response = await fetch(endpoint + '/generate-descriptions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image: imageData,
                        context: context,
                        type: type
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    let html = '<div class="result success"><h3>‚úÖ Success!</h3>';
                    if (result.altText) {
                        html += '<p><strong>Alt Text:</strong> ' + result.altText + '</p>';
                    }
                    if (result.longDescription) {
                        html += '<p><strong>Long Description:</strong> ' + result.longDescription + '</p>';
                    }
                    html += '<p><small>Timestamp: ' + result.timestamp + '</small></p></div>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="result error">‚ùå API Error: ' + (result.error || 'Unknown error') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Request failed: ' + error.message + '</div>';
            }
        }

        function testAltText() {
            testAPI('alt-text');
        }

        function testLongDescription() {
            testAPI('long-description');
        }

        function testBoth() {
            testAPI('both');
        }

        function testSampleImage() {
            const endpoint = document.getElementById('apiEndpoint').value;
            const resultDiv = document.getElementById('sampleResults');

            if (!endpoint) {
                resultDiv.innerHTML = '<div class="result error">Please enter an API endpoint URL first</div>';
                return;
            }

            testAPIWithSample(endpoint, resultDiv);
        }

        async function testAPIWithSample(endpoint, resultDiv) {
            try {
                resultDiv.innerHTML = '<div class="result">Testing with sample image...</div>';
                
                const response = await fetch(endpoint + '/generate-descriptions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image: sampleImage,
                        context: "This is a test image for API validation",
                        type: 'both'
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    let html = '<div class="result success"><h3>‚úÖ Sample Test Successful!</h3>';
                    if (result.altText) {
                        html += '<p><strong>Alt Text:</strong> ' + result.altText + '</p>';
                    }
                    if (result.longDescription) {
                        html += '<p><strong>Long Description:</strong> ' + result.longDescription + '</p>';
                    }
                    html += '</div>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="result error">‚ùå Sample Test Failed: ' + (result.error || 'Unknown error') + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Sample Test Failed: ' + error.message + '</div>';
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Set default endpoint for testing
        document.getElementById('apiEndpoint').value = 'https://your-app-name.vercel.app/api';
    </script>
</body>
</html>
